<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Prep AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Poppins:wght@600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';</script>
    
    <style>
        :root {
            --primary: #6366f1; /* çŸ¥çš„ãªã‚¤ãƒ³ãƒ‡ã‚£ã‚´ */
            --primary-dark: #4f46e5;
            --accent: #10b981;   /* æ­£è§£ã®ã‚°ãƒªãƒ¼ãƒ³ */
            --danger: #ef4444;   /* ä¸æ­£è§£ã®ãƒ¬ãƒƒãƒ‰ */
            --bg-body: #f3f4f6;
            --bg-card: #ffffff;
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --border: #e5e7eb;
            --radius: 16px;
        }

        body {
            font-family: 'Poppins', 'Noto Sans JP', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 40px 20px;
            line-height: 1.6;
        }

        .container { max-width: 800px; margin: 0 auto; }

        header { text-align: center; margin-bottom: 40px; }
        h1 {
            font-size: 2.2rem; font-weight: 700; margin: 0;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            color: var(--primary);
        }
        .subtitle { color: var(--text-sub); font-size: 0.95rem; margin-top: 5px; }

        /* Card Style */
        .card {
            background-color: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 25px;
            border: 1px solid var(--border);
        }

        .form-group { margin-bottom: 20px; }
        label {
            display: flex; align-items: center; justify-content: space-between;
            font-weight: 700; font-size: 0.9rem; margin-bottom: 8px; color: var(--text-sub);
        }
        
        input[type="text"], input[type="password"], select {
            width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 10px;
            font-size: 1rem; box-sizing: border-box; transition: 0.2s;
        }
        input:focus, select:focus { outline: none; border-color: var(--primary); }

        /* File Upload Area */
        .file-drop-zone {
            border: 2px dashed var(--border); border-radius: var(--radius);
            padding: 30px; text-align: center; cursor: pointer; transition: 0.2s;
            background: #fafafa;
        }
        .file-drop-zone:hover { border-color: var(--primary); background: #eef2ff; }
        .file-icon { font-size: 40px; color: #9ca3af; margin-bottom: 10px; }
        .file-list { margin-top: 10px; font-size: 0.85rem; text-align: left; }
        .file-item { display: flex; align-items: center; gap: 5px; color: var(--text-main); margin-bottom: 4px; }

        /* Buttons */
        .btn-group { display: flex; gap: 15px; margin-top: 25px; }
        .btn {
            flex: 1; padding: 15px; border: none; border-radius: 50px;
            font-weight: 700; font-size: 1rem; cursor: pointer;
            display: flex; justify-content: center; align-items: center; gap: 8px;
            transition: all 0.2s; color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); opacity: 0.95; }
        .btn:active { transform: translateY(0); }
        .btn:disabled { background: #cbd5e1; cursor: not-allowed; transform: none; box-shadow: none; }

        .btn-summary { background: linear-gradient(135deg, #10b981, #059669); }
        .btn-exam { background: linear-gradient(135deg, #6366f1, #4f46e5); }

        /* Result Styles */
        .result-area { display: none; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .section-header {
            display: flex; align-items: center; gap: 10px; margin-bottom: 20px;
            padding-bottom: 10px; border-bottom: 2px solid var(--bg-body);
            color: var(--primary-dark); font-weight: 700; font-size: 1.2rem;
        }

        /* Summary Content */
        .summary-box {
            line-height: 1.8; font-size: 0.95rem;
        }
        .summary-box h3 { color: var(--primary); margin-top: 20px; border-left: 4px solid var(--primary); padding-left: 10px; }
        .summary-box ul { padding-left: 20px; background: #f8fafc; padding: 15px 20px 15px 40px; border-radius: 8px; }
        .summary-box strong { color: var(--text-main); background: linear-gradient(transparent 60%, #fff176 60%); }

        /* Quiz Card */
        .quiz-card {
            background: #fff; border: 1px solid var(--border); border-radius: 12px;
            padding: 20px; margin-bottom: 20px; position: relative;
            transition: all 0.3s;
        }
        .quiz-card:hover { box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        
        .quiz-badge {
            background: var(--primary); color: white; padding: 3px 10px; border-radius: 20px;
            font-size: 0.75rem; font-weight: bold; margin-bottom: 10px; display: inline-block;
        }
        .quiz-question { font-weight: 700; font-size: 1.1rem; margin-bottom: 15px; }

        /* Quiz Options */
        .option-btn {
            display: block; width: 100%; text-align: left; padding: 12px 15px;
            margin-bottom: 8px; border: 2px solid var(--border); border-radius: 10px;
            background: #fff; cursor: pointer; transition: 0.2s; font-size: 0.95rem;
            position: relative;
        }
        .option-btn:hover { border-color: #c7d2fe; background: #eef2ff; }
        .option-btn.correct { border-color: var(--accent); background: #ecfdf5; color: #065f46; font-weight: bold; }
        .option-btn.wrong { border-color: var(--danger); background: #fef2f2; color: #991b1b; }
        .option-btn:disabled { cursor: default; }

        /* Explanation Box */
        .explanation-box {
            margin-top: 15px; padding: 15px; background: #f0f9ff;
            border: 1px solid #bae6fd; border-radius: 10px; color: #0369a1;
            display: none; font-size: 0.9rem; line-height: 1.6;
        }
        .exp-label { font-weight: bold; display: block; margin-bottom: 5px; }

        .loader {
            width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.3);
            border-top-color: #fff; border-radius: 50%;
            animation: spin 1s linear infinite; display: none;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .api-link { color: var(--primary); text-decoration: none; font-weight: normal; font-size: 0.8rem; }
        .error-msg { background: #fee2e2; color: #ef4444; padding: 15px; border-radius: 10px; margin-top: 15px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>
            <span class="material-icons-round" style="font-size: 40px;">school</span>
            Exam Prep AI
        </h1>
        <div class="subtitle">æˆæ¥­è³‡æ–™ã‹ã‚‰ã€Œè©¦é¨“å•é¡Œã€ã¨ã€Œè¦ç‚¹ã¾ã¨ã‚ã€ã‚’è‡ªå‹•ä½œæˆ</div>
    </header>

    <div class="card">
        <div class="form-group">
            <label>
                API Key (Google Gemini)
                <a href="help.html" target="_blank" class="api-link">å–å¾—æ–¹æ³•</a>
            </label>
            <input type="password" id="apiKey" placeholder="Alza...">
        </div>

        <div class="form-group">
            <label>å­¦ç¿’è³‡æ–™ (PDF / ç”»åƒ) <span style="font-weight:normal; font-size:0.8em; color:#ef4444;">â€»å¿…é ˆ</span></label>
            <div class="file-drop-zone" onclick="document.getElementById('studyFiles').click()">
                <span class="material-icons-round file-icon">cloud_upload</span><br>
                <div>ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</div>
                <div style="font-size:0.8rem; color:#9ca3af;">(è¤‡æ•°é¸æŠå¯)</div>
            </div>
            <input type="file" id="studyFiles" multiple accept="application/pdf, image/*" style="display:none" onchange="updateFileList('studyFiles', 'studyFileList')">
            <div id="studyFileList" class="file-list"></div>
        </div>

        <div class="form-group">
            <label>éå»å• (ä»»æ„) <span style="font-weight:normal; font-size:0.8em;">â€»å‚¾å‘åˆ†æã«ä½¿ç”¨</span></label>
            <div class="file-drop-zone" style="padding:15px; border-style:dotted;" onclick="document.getElementById('pastFiles').click()">
                <div style="color:#6b7280; font-size:0.9rem;">
                    <span class="material-icons-round" style="vertical-align:middle; margin-right:5px;">history_edu</span>
                    éå»å•ãŒã‚ã‚Œã°ã“ã“ã«è¿½åŠ 
                </div>
            </div>
            <input type="file" id="pastFiles" multiple accept="application/pdf, image/*" style="display:none" onchange="updateFileList('pastFiles', 'pastFileList')">
            <div id="pastFileList" class="file-list"></div>
        </div>

        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
            <div class="form-group" style="flex:1; min-width: 200px;">
                <label>å‡ºé¡Œå½¢å¼</label>
                <select id="questionType">
                    <option value="4æŠå•é¡Œ">4æŠå•é¡Œ (Multiple Choice)</option>
                    <option value="â—‹Ã—å•é¡Œ">â—‹Ã—å•é¡Œ (True/False)</option>
                    <option value="è¨˜è¿°å¼">è¨˜è¿°ãƒ»è«–è¿°å¼ (Essay)</option>
                    <option value="ç©´åŸ‹ã‚">ç©´åŸ‹ã‚å•é¡Œ (Fill-in-the-blank)</option>
                </select>
            </div>
            <div class="form-group" style="flex:1; min-width: 200px;">
                <label>é›£æ˜“åº¦</label>
                <select id="difficulty">
                    <option value="åŸºç¤">ğŸ”° åŸºç¤ (ç”¨èªç¢ºèª)</option>
                    <option value="æ¨™æº–" selected>ğŸ“š æ¨™æº– (å®šæœŸè©¦é¨“ãƒ¬ãƒ™ãƒ«)</option>
                    <option value="å¿œç”¨">ğŸ”¥ å¿œç”¨ (é«˜å¾—ç‚¹ç‹™ã„)</option>
                </select>
            </div>
        </div>

        <div class="btn-group">
            <button class="btn btn-summary" onclick="processRequest('summary')">
                <span class="material-icons-round">summarize</span> è¦ç‚¹ã‚’ã¾ã¨ã‚ã‚‹
                <div class="loader" id="loader-summary"></div>
            </button>
            <button class="btn btn-exam" onclick="processRequest('exam')">
                <span class="material-icons-round">quiz</span> äºˆæƒ³å•é¡Œã‚’ä½œæˆ
                <div class="loader" id="loader-exam"></div>
            </button>
        </div>
        <div id="errorMsg" class="error-msg"></div>
    </div>

    <div id="outputArea" class="result-area">
        <div id="summaryResult" class="card" style="display:none; border-top: 5px solid var(--accent);">
            <div class="section-header">
                <span class="material-icons-round" style="color:var(--accent);">lightbulb</span>
                è©¦é¨“ç¯„å›²ã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ
            </div>
            <div class="summary-box" id="summaryContent"></div>
        </div>

        <div id="examResult" style="display:none;">
            <div class="card" style="border-top: 5px solid var(--primary); margin-bottom:20px;">
                <div class="section-header">
                    <span class="material-icons-round" style="color:var(--primary);">assignment</span>
                    AIäºˆæƒ³å•é¡Œ
                </div>
                <div style="font-size:0.9rem; color:var(--text-sub);">
                    è³‡æ–™ã«åŸºã¥ã„ãŸäºˆæƒ³å•é¡Œã§ã™ã€‚ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ­£è§£ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚
                </div>
            </div>
            <div id="quizContainer"></div>
        </div>
    </div>
</div>

<script>
    // --- 1. File Handling ---
    
    function updateFileList(inputId, listId) {
        const input = document.getElementById(inputId);
        const list = document.getElementById(listId);
        list.innerHTML = "";
        if (input.files.length > 0) {
            for (let i = 0; i < input.files.length; i++) {
                list.innerHTML += `<div class="file-item"><span class="material-icons-round" style="font-size:18px; color:var(--primary);">check_circle</span> ${input.files[i].name}</div>`;
            }
        }
    }

    async function readPdfToText(file) {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        let fullText = "";
        for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const textContent = await page.getTextContent();
            const pageText = textContent.items.map(item => item.str).join(" ");
            fullText += `[Page ${i}] ${pageText}\n`;
        }
        return fullText;
    }

    function readImageToBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = reject;
            reader.readAsDataURL(file);
        });
    }

    async function processFiles() {
        const studyFiles = document.getElementById('studyFiles').files;
        const pastFiles = document.getElementById('pastFiles').files;
        let textContext = "ã€å­¦ç¿’è³‡æ–™ãƒ†ã‚­ã‚¹ãƒˆã€‘\n";
        let images = [];

        const handleFiles = async (fileList, label) => {
            for (let i = 0; i < fileList.length; i++) {
                const file = fileList[i];
                if (file.type === "application/pdf") {
                    try {
                        const text = await readPdfToText(file);
                        textContext += `\n--- ${label}: ${file.name} ---\n${text}\n`;
                    } catch (e) { console.error(e); }
                } else if (file.type.startsWith("image/")) {
                    const base64 = await readImageToBase64(file);
                    images.push({ inlineData: { data: base64, mimeType: file.type } });
                }
            }
        };

        await handleFiles(studyFiles, "å­¦ç¿’è³‡æ–™");
        if (pastFiles.length > 0) {
            textContext += "\nã€éå»å•è³‡æ–™ã€‘(ä»¥ä¸‹ã®å‚¾å‘ã‚’åˆ†æã—ã¦åæ˜ )\n";
            await handleFiles(pastFiles, "éå»å•");
        }
        return { text: textContext, images: images };
    }

    // --- 2. Gemini API Interaction ---

    async function findWorkingModel(apiKey) {
        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);
            const data = await response.json();
            const models = data.models || [];
            // generateContent ãŒä½¿ãˆã‚‹ãƒ¢ãƒ‡ãƒ«ã‚’æ¢ã™
            const validModel = models.find(m => m.name.includes("flash") && m.supportedGenerationMethods.includes("generateContent")) 
                            || models.find(m => m.name.includes("pro") && m.supportedGenerationMethods.includes("generateContent"));
            return validModel ? validModel.name.replace('models/', '') : "gemini-1.5-flash";
        } catch { return "gemini-1.5-flash"; }
    }

    async function processRequest(type) {
        const apiKey = document.getElementById('apiKey').value.trim();
        const qType = document.getElementById('questionType').value;
        const diff = document.getElementById('difficulty').value;
        const errorMsg = document.getElementById('errorMsg');
        
        if (!apiKey) {
            errorMsg.style.display = 'block'; errorMsg.innerText = "APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"; return;
        }
        if (document.getElementById('studyFiles').files.length === 0) {
            errorMsg.style.display = 'block'; errorMsg.innerText = "å­¦ç¿’è³‡æ–™ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„"; return;
        }

        // Reset UI
        errorMsg.style.display = 'none';
        document.getElementById('outputArea').style.display = 'none';
        document.getElementById(`loader-${type}`).style.display = 'block';
        
        try {
            const fileData = await processFiles();
            const modelName = await findWorkingModel(apiKey);
            
            let systemPrompt = "";
            if (type === 'summary') {
                systemPrompt = `
ã‚ãªãŸã¯å„ªç§€ãªå­¦ç¿’ãƒãƒ¥ãƒ¼ã‚¿ãƒ¼ã§ã™ã€‚æä¾›ã•ã‚ŒãŸè³‡æ–™ã«åŸºã¥ã„ã¦ã€è©¦é¨“ã«å‡ºã‚‹å¯èƒ½æ€§ãŒé«˜ã„é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã‚’è¦ç´„ã—ã¦ãã ã•ã„ã€‚
å‡ºåŠ›ã¯HTMLå½¢å¼ã§ã€<h3>è¦‹å‡ºã—</h3>ã€<ul><li>ç®‡æ¡æ›¸ã</li></ul>ã€é‡è¦ãªå˜èªã¯<strong>å¤ªå­—</strong>ã‚’ä½¿ã£ã¦è¦‹ã‚„ã™ãæ•´å½¢ã—ã¦ãã ã•ã„ã€‚Markdownã¯ä¸è¦ã§ã™ã€‚`;
            } else {
                systemPrompt = `
ã‚ãªãŸã¯è©¦é¨“å•é¡Œä½œæˆã®ãƒ—ãƒ­ã§ã™ã€‚æä¾›ã•ã‚ŒãŸè³‡æ–™ï¼ˆãŠã‚ˆã³éå»å•ï¼‰ã«åŸºã¥ã„ã¦ã€äºˆæƒ³å•é¡Œã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
å½¢å¼: ${qType}ã€é›£æ˜“åº¦: ${diff}ã€å•é¡Œæ•°: 3ã€œ5å•ã€‚

ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‘
ä»¥ä¸‹ã®JSONå½¢å¼ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼ˆMarkdownè¨˜æ³•ã¯ä¸è¦ï¼‰ã€‚
[
  {
    "question": "å•é¡Œæ–‡",
    "options": ["é¸æŠè‚¢1", "é¸æŠè‚¢2", "é¸æŠè‚¢3", "é¸æŠè‚¢4"], // è¨˜è¿°å¼ã®å ´åˆã¯ç©ºé…åˆ—[]
    "answer": "æ­£è§£ã®æ–‡å­—åˆ—",
    "explanation": "è©³ã—ã„è§£èª¬ã€‚è³‡æ–™ã®ã©ã®éƒ¨åˆ†ã«åŸºã¥ãã‹ã‚‚è¨€åŠã€‚"
  }
]`;
            }

            const contents = [{
                parts: [
                    { text: systemPrompt },
                    { text: fileData.text },
                    ...fileData.images 
                ]
            }];

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: contents })
            });

            if (!response.ok) throw new Error("APIã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
            const data = await response.json();
            const resultText = data.candidates[0].content.parts[0].text;

            document.getElementById('outputArea').style.display = 'block';
            
            if (type === 'summary') {
                document.getElementById('summaryResult').style.display = 'block';
                document.getElementById('examResult').style.display = 'none';
                document.getElementById('summaryContent').innerHTML = resultText.replace(/```html|```/g, '');
                document.getElementById('summaryResult').scrollIntoView({ behavior: 'smooth' });
            } else {
                document.getElementById('summaryResult').style.display = 'none';
                document.getElementById('examResult').style.display = 'block';
                const jsonText = resultText.replace(/```json|```/g, '').trim();
                const questions = JSON.parse(jsonText);
                renderQuiz(questions, qType);
                document.getElementById('examResult').scrollIntoView({ behavior: 'smooth' });
            }

        } catch (e) {
            console.error(e);
            errorMsg.innerText = "ã‚¨ãƒ©ãƒ¼: " + e.message;
            errorMsg.style.display = 'block';
        } finally {
            document.getElementById(`loader-${type}`).style.display = 'none';
        }
    }

    // --- 3. Quiz Rendering ---

    function renderQuiz(questions, type) {
        const container = document.getElementById('quizContainer');
        container.innerHTML = "";

        questions.forEach((q, index) => {
            const card = document.createElement('div');
            card.className = 'quiz-card';
            
            let optionsHtml = "";
            if (q.options && q.options.length > 0) {
                // é¸æŠå¼
                q.options.forEach(opt => {
                    // escape quotes for safety
                    const safeOpt = opt.replace(/'/g, "\\'");
                    const safeAns = q.answer.replace(/'/g, "\\'");
                    optionsHtml += `<button class="option-btn" onclick="checkAnswer(this, '${safeOpt}', '${safeAns}')">${opt}</button>`;
                });
            } else {
                // è¨˜è¿°å¼
                optionsHtml = `
                    <textarea style="width:100%; border:2px solid #e5e7eb; padding:15px; border-radius:10px; font-family:inherit;" rows="3" placeholder="ã“ã“ã«å›ç­”ã‚’å…¥åŠ›"></textarea>
                    <button class="btn btn-exam" style="margin-top:10px; font-size:0.9rem; padding:10px;" onclick="showAnswer(this)">æ¨¡ç¯„è§£ç­”ã‚’è¦‹ã‚‹</button>
                `;
            }

            card.innerHTML = `
                <div class="quiz-badge">Q${index + 1}</div>
                <div class="quiz-question">${q.question}</div>
                <div class="quiz-options-container">${optionsHtml}</div>
                <div class="explanation-box">
                    <span class="exp-label"><span class="material-icons-round" style="font-size:16px; vertical-align:text-bottom;">check_circle</span> æ­£è§£: ${q.answer}</span>
                    ${q.explanation}
                </div>
            `;
            container.appendChild(card);
        });
    }

    // é¸æŠå¼ã®æ­£èª¤åˆ¤å®š
    window.checkAnswer = function(btn, userAns, correctAns) {
        const container = btn.parentElement;
        const explanation = container.nextElementSibling;
        const allBtns = container.querySelectorAll('.option-btn');
        
        allBtns.forEach(b => b.disabled = true); // ä¸€åº¦ç­”ãˆãŸã‚‰ç„¡åŠ¹åŒ–

        if (userAns === correctAns) {
            btn.classList.add('correct');
            // æ­£è§£éŸ³ãªã©ã‚’é³´ã‚‰ã™ãªã‚‰ã“ã“
        } else {
            btn.classList.add('wrong');
            // æ­£è§£ã®ãƒœã‚¿ãƒ³ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            allBtns.forEach(b => {
                if (b.innerText === correctAns) b.classList.add('correct');
            });
        }
        $(explanation).fadeIn(); // jQueryãªã—ãªã®ã§ä¸‹è¨˜ã§ä»£ç”¨
        explanation.style.display = 'block';
        explanation.animate([{opacity:0}, {opacity:1}], {duration:300});
    }

    // è¨˜è¿°å¼ã®è§£ç­”è¡¨ç¤º
    window.showAnswer = function(btn) {
        const container = btn.parentElement;
        const explanation = container.parentElement.querySelector('.explanation-box');
        btn.style.display = 'none';
        explanation.style.display = 'block';
        explanation.animate([{opacity:0}, {opacity:1}], {duration:300});
    }

</script>

</body>
</html>
